{{ $img := .img }}
{{ $alt := .alt }}
{{ $class := .class }}
{{ $lazy := .lazy }}
{{ $caption := .title }}
{{ $setwidths := .setwidths }}

{{/* SET DEFAULTS */}}
{{- $respSizes := slice "800" "1600" -}}
{{- $defaultSize := "640" -}}
{{- $dataSzes := "(max-width: 800px) 100vw, 800px" -}}
{{- $resizeCmd := "640x jpg Lanczos" -}}
{{- $pictureClass := "lightense-wrap" -}}
{{- $imgClass := "lazy responsive" -}}

{{- if $setwidths  -}}
  {{- $respSizes =  $setwidths -}}
  {{- $defaultSize = index $respSizes 0 -}}
{{- end -}}

{{ $resizeCmd = printf "%sx jpg q75 CatmullRom" $defaultSize }}

{{ if .pictureClass }}
  {{ $pictureClass = .pictureClass }}
{{ end }}

{{- with $src := resources.Get ($img) -}}
  {{- $actualImg := $src.Resize $resizeCmd -}}
  <picture class={{$pictureClass}}>
    <source
      type="image/webp"
      data-srcset="
        {{- with $respSizes -}}
          {{- range $i, $e := . -}}
          {{- if ge $src.Width . -}}
            {{- if $i }}, {{ end -}}{{- ($src.Resize (printf "%sx%s" . " q75 CatmullRom webp") ).RelPermalink }} {{ . }}w
          {{- end -}}
        {{- end -}}
      {{- end -}}"
      data-sizes="{{ $dataSzes }}"
    />
    <source
      type="image/jpeg"
      data-srcset="
        {{- with $respSizes -}}
          {{- range $i, $e := . -}}
            {{- if ge $src.Width . -}}
              {{- if $i }}, {{ end -}}{{- ($src.Resize (printf "%sx%s" . " q75 CatmullRom jpg") ).RelPermalink }} {{ . }}w
            {{- end -}}
        {{- end -}}
      {{- end -}}"\
      data-sizes="{{ $dataSzes }}"
    />
    <img class="{{ $imgClass }}"
      src="{{ $actualImg.RelPermalink }}"
      width="{{ $actualImg.Width }}"
      height="{{ $actualImg.Height }}"
      alt="{{ $alt }}"
      title="{{ .Title }}"
    />
  </picture>
{{- else -}}
<img extra="MISSINGIMAGE" src="{{ $img | safeURL }}"
  {{- with .Text }} alt="{{ . }}"{{ end -}}
  {{- with .Title }} title="{{ . }}"{{ end -}}
>
{{- end -}}





